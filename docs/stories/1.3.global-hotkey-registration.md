# 1.3 Global Hotkey Registration

## –°—Ç–∞—Ç—É—Å: üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è overlay –æ–∫–Ω–∞ —Å –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π macOS (Globe key), Windows –∏ Linux (GNOME Wayland —á–µ—Ä–µ–∑ D-Bus).

## –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

- **GNOME Wayland D-Bus –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê) - Wayland –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ hotkeys –Ω–∞–ø—Ä—è–º—É—é, —Ç—Ä–µ–±—É–µ—Ç—Å—è D-Bus –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å GNOME Shell
- **macOS Globe key –æ–±—Ä–∞–±–æ—Ç–∫–∞** (‚≠ê‚≠ê‚≠ê‚≠ê) - Globe key —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ IOKit/Carbon
- **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è** (‚≠ê‚≠ê‚≠ê‚≠ê) - –†–∞–∑–Ω—ã–µ API –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
- **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ hotkeys** (‚≠ê‚≠ê‚≠ê) - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ hotkey —É–∂–µ –∑–∞–Ω—è—Ç

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- ‚úÖ Story 1.1 - Electron Project Setup (–∑–∞–≤–µ—Ä—à–µ–Ω–æ)
- ‚úÖ Story 1.2 - Window Manager & Overlay (–∑–∞–≤–µ—Ä—à–µ–Ω–æ)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è Global Hotkeys

#### 1.1 –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞: electron-localshortcut
–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ hotkeys –∏—Å–ø–æ–ª—å–∑—É–µ–º `electron-localshortcut`, –Ω–æ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω—É–∂–Ω–æ —Ä–µ—à–µ–Ω–∏–µ:

**–û–ø—Ü–∏–∏:**
1. **electron-globalshortcut** (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Electron API)
   - ‚úÖ –ü—Ä–æ—Å—Ç–æ–π API
   - ‚úÖ –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π
   - ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∞–≤–∏—à (Globe key)
   - ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Wayland

2. **uiohook-napi** (Native Node.js addon)
   - ‚úÖ Low-level –¥–æ—Å—Ç—É–ø –∫ keyboard events
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–∏—Å—Ç–µ–º
   - ‚ùå –°–ª–æ–∂–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (native compilation)
   - ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å macOS permissions

3. **node-global-key-listener**
   - ‚úÖ –ß–∏—Å—Ç—ã–π JavaScript
   - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ macOS, Windows, Linux
   - ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç native compilation
   - ‚ö†Ô∏è –ú–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å Globe key

**–†–µ—à–µ–Ω–∏–µ:** –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- **Windows/macOS X11**: `electron-globalshortcut`
- **macOS Globe key**: Custom IOKit integration
- **Linux Wayland (GNOME)**: D-Bus API

#### 1.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install --save electron-localshortcut
npm install --save-dev @types/node
```

–î–ª—è macOS Globe key –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
```typescript
// electron/main/hotkeys/macos-globe-key.ts
import { NativeKeyboard } from 'electron'
```

–î–ª—è GNOME Wayland:
```bash
npm install dbus-next
```

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Hotkey Manager

#### 2.1 Main Process: HotkeyManager –∫–ª–∞—Å—Å

```typescript
// electron/main/hotkey-manager.ts
interface HotkeyConfig {
  key: string;           // 'F1', 'CommandOrControl+Space', 'Globe'
  platform: NodeJS.Platform;
  handler: () => void;
}

class HotkeyManager {
  private registeredHotkeys: Map<string, HotkeyConfig>;
  private gnomeDbusConnection?: DBusConnection;

  constructor(private windowManager: WindowManager) {
    this.registeredHotkeys = new Map();
  }

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è hotkey
  async register(config: HotkeyConfig): Promise<boolean> {
    const platform = process.platform;

    if (platform === 'darwin') {
      return this.registerMacOS(config);
    } else if (platform === 'win32') {
      return this.registerWindows(config);
    } else if (platform === 'linux') {
      return this.registerLinux(config);
    }

    return false;
  }

  // macOS —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  private async registerMacOS(config: HotkeyConfig): Promise<boolean> {
    if (config.key === 'Globe') {
      return this.registerGlobeKey(config.handler);
    } else {
      return this.registerElectronShortcut(config.key, config.handler);
    }
  }

  // Globe key —á–µ—Ä–µ–∑ IOKit
  private async registerGlobeKey(handler: () => void): Promise<boolean> {
    // TODO: Implement IOKit Globe key registration
    // Requires Carbon or IOKit framework access
    // May need native addon or Electron IPC to native code
    return false;
  }

  // Windows hotkey registration
  private async registerWindows(config: HotkeyConfig): Promise<boolean> {
    return this.registerElectronShortcut(config.key, config.handler);
  }

  // Linux hotkey registration
  private async registerLinux(config: HotkeyConfig): Promise<boolean> {
    const session = process.env.XDG_SESSION_TYPE;

    if (session === 'wayland') {
      return this.registerWaylandHotkey(config);
    } else {
      // X11 - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å electron globalShortcut
      return this.registerElectronShortcut(config.key, config.handler);
    }
  }

  // GNOME Wayland —á–µ—Ä–µ–∑ D-Bus
  private async registerWaylandHotkey(config: HotkeyConfig): Promise<boolean> {
    try {
      // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GNOME Shell D-Bus
      const bus = dbus.sessionBus();
      const shell = await bus.getProxyObject(
        'org.gnome.Shell',
        '/org/gnome/Shell'
      );

      const grabbers = shell.getInterface('org.gnome.Shell.Introspect');

      // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è accelerator
      const action = await grabbers.GrabAccelerator(
        config.key,
        0, // mode flags
        {} // options
      );

      this.gnomeDbusConnection = { bus, action };

      // –°–ª—É—à–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
      bus.on('signal', (msg) => {
        if (msg.member === 'AcceleratorActivated') {
          config.handler();
        }
      });

      return true;
    } catch (error) {
      console.error('Failed to register Wayland hotkey:', error);
      return false;
    }
  }

  // Fallback —á–µ—Ä–µ–∑ electron globalShortcut
  private registerElectronShortcut(accelerator: string, handler: () => void): boolean {
    const { globalShortcut } = require('electron');

    const success = globalShortcut.register(accelerator, handler);

    if (success) {
      this.registeredHotkeys.set(accelerator, {
        key: accelerator,
        platform: process.platform,
        handler
      });
    }

    return success;
  }

  // –û—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  unregisterAll(): void {
    const { globalShortcut } = require('electron');
    globalShortcut.unregisterAll();

    // Cleanup GNOME D-Bus
    if (this.gnomeDbusConnection) {
      // TODO: Cleanup D-Bus connection
    }

    this.registeredHotkeys.clear();
  }
}
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Hotkeys

#### 3.1 Default Hotkeys

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:

- **macOS**:
  - Primary: `Globe + Space` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  - Fallback: `Command + Shift + Space`

- **Windows**:
  - `Win + Shift + Space`

- **Linux**:
  - `Super + Shift + Space`

#### 3.2 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–†–∞—Å—à–∏—Ä—è–µ–º `~/.mcp-voice-hooks/electron-config.json`:

```json
{
  "window": {
    "position": { "x": 100, "y": 100 },
    "visible": true,
    "alwaysOnTop": true
  },
  "hotkeys": {
    "toggleOverlay": {
      "enabled": true,
      "key": "Globe+Space",           // macOS
      "fallback": "CommandOrControl+Shift+Space"
    }
  }
}
```

### 4. UI –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Hotkeys

#### 4.1 Settings Panel –≤ Renderer

–î–æ–±–∞–≤–ª—è–µ–º –≤ overlay UI —Å–µ–∫—Ü–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–∫:

```html
<!-- electron/renderer/index.html -->
<div id="settings-panel" class="hidden">
  <div class="setting-item">
    <label>Toggle Overlay Hotkey:</label>
    <div class="hotkey-recorder">
      <input
        type="text"
        id="hotkey-display"
        readonly
        placeholder="Press keys..."
      />
      <button id="record-hotkey">Change</button>
      <button id="reset-hotkey">Reset to Default</button>
    </div>
  </div>

  <div class="setting-item">
    <label>Current binding:</label>
    <span id="current-hotkey">Globe + Space</span>
  </div>
</div>
```

#### 4.2 Hotkey Recording Logic

```typescript
// electron/renderer/settings.ts
class HotkeyRecorder {
  private isRecording = false;
  private currentKeys: Set<string> = new Set();

  startRecording() {
    this.isRecording = true;
    this.currentKeys.clear();

    document.addEventListener('keydown', this.onKeyDown);
    document.addEventListener('keyup', this.onKeyUp);
  }

  stopRecording() {
    this.isRecording = false;
    document.removeEventListener('keydown', this.onKeyDown);
    document.removeEventListener('keyup', this.onKeyUp);

    // Send –Ω–æ–≤—ã–π hotkey –≤ main process
    const hotkey = Array.from(this.currentKeys).join('+');
    window.electronAPI.setHotkey(hotkey);
  }

  private onKeyDown = (event: KeyboardEvent) => {
    event.preventDefault();

    if (event.key === 'Meta' || event.key === 'Control' ||
        event.key === 'Shift' || event.key === 'Alt') {
      this.currentKeys.add(this.normalizeModifier(event.key));
    } else {
      this.currentKeys.add(event.key);
    }

    this.updateDisplay();
  }

  private onKeyUp = (event: KeyboardEvent) => {
    // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–ø–∏—Å—å –ø–æ—Å–ª–µ –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è –≤—Å–µ—Ö –∫–ª–∞–≤–∏—à
    if (this.currentKeys.size > 0) {
      setTimeout(() => this.stopRecording(), 500);
    }
  }

  private normalizeModifier(key: string): string {
    const map: Record<string, string> = {
      'Meta': 'Command',
      'Control': 'Control',
      'Shift': 'Shift',
      'Alt': 'Option'
    };
    return map[key] || key;
  }

  private updateDisplay() {
    const display = document.getElementById('hotkey-display') as HTMLInputElement;
    display.value = Array.from(this.currentKeys).join(' + ');
  }
}
```

### 5. IPC API –¥–ª—è Hotkeys

#### 5.1 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Window API

```typescript
// electron/preload/types.ts
export interface ElectronAPI {
  platform: NodeJS.Platform;

  // Existing window methods...

  // Hotkey methods
  setHotkey(accelerator: string): Promise<boolean>;
  getHotkey(): Promise<string>;
  resetHotkey(): Promise<void>;

  // Hotkey events
  onHotkeyConflict(callback: (error: string) => void): void;
}
```

#### 5.2 IPC Handlers –≤ Main Process

```typescript
// electron/main/index.ts
import { ipcMain } from 'electron';

ipcMain.handle('set-hotkey', async (event, accelerator: string) => {
  try {
    const success = await hotkeyManager.register({
      key: accelerator,
      platform: process.platform,
      handler: () => windowManager.toggleVisibility()
    });

    if (success) {
      // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
      await configManager.setHotkey(accelerator);
    } else {
      throw new Error('Failed to register hotkey');
    }

    return success;
  } catch (error) {
    // –£–≤–µ–¥–æ–º–∏—Ç—å renderer –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ
    event.sender.send('hotkey-conflict', error.message);
    return false;
  }
});

ipcMain.handle('get-hotkey', async () => {
  return configManager.getHotkey();
});

ipcMain.handle('reset-hotkey', async () => {
  const defaultHotkey = getDefaultHotkey(process.platform);
  await hotkeyManager.unregisterAll();
  await hotkeyManager.register({
    key: defaultHotkey,
    platform: process.platform,
    handler: () => windowManager.toggleVisibility()
  });
  await configManager.setHotkey(defaultHotkey);
});
```

### 6. Platform-Specific Implementations

#### 6.1 macOS Globe Key

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Electron Native Module**

```typescript
// electron/main/hotkeys/macos-globe-key.ts
import { NativeKeyboard } from 'electron';

export class MacOSGlobeKeyHandler {
  private callback: (() => void) | null = null;

  register(handler: () => void): boolean {
    try {
      // –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Electron API –¥–ª—è Globe key
      // NOTE: –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ Electron
      this.callback = handler;

      // TODO: Implement native Globe key listener
      // –í–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è native addon –∏–ª–∏ AppleScript

      return false; // Not implemented yet
    } catch (error) {
      console.error('Globe key registration failed:', error);
      return false;
    }
  }

  unregister(): void {
    this.callback = null;
  }
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ AppleScript (workaround)**

```typescript
import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

async function setupGlobeKeyMonitor(handler: () => void): Promise<void> {
  const script = `
    tell application "System Events"
      key code 63 using {function down}  -- Globe key (Fn key on older keyboards)
    end tell
  `;

  // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π polling (–Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
  setInterval(async () => {
    try {
      await execAsync(`osascript -e '${script}'`);
      handler();
    } catch {
      // Globe –Ω–µ –Ω–∞–∂–∞—Ç
    }
  }, 100);
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Globe key - —ç—Ç–æ —Å–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞. Electron –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –í–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
1. Native Node.js addon –Ω–∞ Objective-C
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IOKit framework
3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –Ω–∞ –¥—Ä—É–≥—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é

#### 6.2 Windows Implementation

Windows –ø—Ä–æ—â–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `globalShortcut`:

```typescript
// electron/main/hotkeys/windows-hotkey.ts
import { globalShortcut } from 'electron';

export class WindowsHotkeyHandler {
  register(accelerator: string, handler: () => void): boolean {
    try {
      const success = globalShortcut.register(accelerator, handler);

      if (!success) {
        console.error('Hotkey already registered by another app:', accelerator);
      }

      return success;
    } catch (error) {
      console.error('Failed to register hotkey:', error);
      return false;
    }
  }

  unregister(accelerator: string): void {
    globalShortcut.unregister(accelerator);
  }

  unregisterAll(): void {
    globalShortcut.unregisterAll();
  }
}
```

#### 6.3 Linux GNOME Wayland D-Bus Implementation

–ù–∞–∏–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å:

```typescript
// electron/main/hotkeys/gnome-wayland-dbus.ts
import dbus from 'dbus-next';

interface GnomeShellGrabber {
  GrabAccelerator(
    accelerator: string,
    modeFlags: number,
    grabFlags: number
  ): Promise<number>;

  UngrabAccelerator(action: number): Promise<boolean>;
}

export class GnomeWaylandHotkeyHandler {
  private bus?: dbus.MessageBus;
  private actionId?: number;

  async register(accelerator: string, handler: () => void): Promise<boolean> {
    try {
      this.bus = dbus.sessionBus();

      const obj = await this.bus.getProxyObject(
        'org.gnome.Shell',
        '/org/gnome/Shell'
      );

      const shell = obj.getInterface('org.gnome.Shell') as unknown as GnomeShellGrabber;

      // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Electron accelerator –≤ GNOME —Ñ–æ—Ä–º–∞—Ç
      const gnomeAccel = this.convertToGnomeFormat(accelerator);

      // Grab accelerator
      this.actionId = await shell.GrabAccelerator(
        gnomeAccel,
        0, // mode flags
        0  // grab flags
      );

      if (this.actionId === 0) {
        throw new Error('Failed to grab accelerator (ID = 0)');
      }

      // Listen –¥–ª—è activation events
      this.bus.on('message', (msg) => {
        if (
          msg.type === dbus.MessageType.SIGNAL &&
          msg.interface === 'org.gnome.Shell' &&
          msg.member === 'AcceleratorActivated'
        ) {
          const [actionId] = msg.body;
          if (actionId === this.actionId) {
            handler();
          }
        }
      });

      return true;
    } catch (error) {
      console.error('GNOME Wayland hotkey registration failed:', error);
      return false;
    }
  }

  async unregister(): Promise<void> {
    if (!this.bus || !this.actionId) return;

    try {
      const obj = await this.bus.getProxyObject(
        'org.gnome.Shell',
        '/org/gnome/Shell'
      );

      const shell = obj.getInterface('org.gnome.Shell') as unknown as GnomeShellGrabber;
      await shell.UngrabAccelerator(this.actionId);
    } catch (error) {
      console.error('Failed to ungrab accelerator:', error);
    }
  }

  private convertToGnomeFormat(electronAccel: string): string {
    // Electron: "Super+Shift+Space"
    // GNOME:   "<Super><Shift>space"

    return electronAccel
      .replace(/\+/g, '')
      .replace(/([A-Z][a-z]+)/g, '<$1>')
      .toLowerCase()
      .replace(/<([a-z]+)>/g, (_, key) => `<${key.charAt(0).toUpperCase() + key.slice(1)}>`);
  }
}
```

### 7. Error Handling –∏ Fallbacks

#### 7.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ hotkey

```typescript
class HotkeyManager {
  async register(config: HotkeyConfig): Promise<boolean> {
    const success = await this.platformSpecificRegister(config);

    if (!success) {
      // –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å fallback
      const fallback = this.getFallbackHotkey(config.platform);

      if (fallback) {
        console.warn(`Using fallback hotkey: ${fallback}`);
        return this.platformSpecificRegister({
          ...config,
          key: fallback
        });
      }

      // –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ UI
      this.notifyHotkeyConflict(config.key);
      return false;
    }

    return true;
  }

  private getFallbackHotkey(platform: NodeJS.Platform): string | null {
    const fallbacks: Record<NodeJS.Platform, string> = {
      darwin: 'Command+Shift+Space',
      win32: 'Control+Shift+Space',
      linux: 'Super+Shift+Space'
    };

    return fallbacks[platform] || null;
  }

  private notifyHotkeyConflict(key: string): void {
    // Send event to renderer
    const { webContents } = require('electron');

    webContents.getAllWebContents().forEach(wc => {
      wc.send('hotkey-conflict', {
        key,
        message: `Hotkey "${key}" is already in use. Please choose a different one.`
      });
    });
  }
}
```

#### 7.2 Permissions handling (macOS)

–ù–∞ macOS –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è Accessibility permissions:

```typescript
// electron/main/permissions/macos-accessibility.ts
import { systemPreferences } from 'electron';

export function checkAccessibilityPermissions(): boolean {
  if (process.platform !== 'darwin') return true;

  return systemPreferences.isTrustedAccessibilityClient(true);
}

export function requestAccessibilityPermissions(): void {
  if (process.platform !== 'darwin') return;

  const trusted = systemPreferences.isTrustedAccessibilityClient(false);

  if (!trusted) {
    systemPreferences.isTrustedAccessibilityClient(true); // Prompt user
  }
}
```

### 8. Testing

#### 8.1 Unit Tests

```typescript
// electron/main/hotkey-manager.test.ts
import { HotkeyManager } from './hotkey-manager';
import { WindowManager } from './window-manager';

describe('HotkeyManager', () => {
  let hotkeyManager: HotkeyManager;
  let windowManager: WindowManager;

  beforeEach(() => {
    windowManager = new WindowManager({
      width: 400,
      height: 100,
      position: { x: 100, y: 100 }
    });

    hotkeyManager = new HotkeyManager(windowManager);
  });

  afterEach(() => {
    hotkeyManager.unregisterAll();
  });

  describe('register', () => {
    it('should register a hotkey successfully', async () => {
      const result = await hotkeyManager.register({
        key: 'CommandOrControl+Shift+Space',
        platform: process.platform,
        handler: () => {}
      });

      expect(result).toBe(true);
    });

    it('should fail to register duplicate hotkey', async () => {
      const config = {
        key: 'CommandOrControl+Shift+Space',
        platform: process.platform,
        handler: () => {}
      };

      await hotkeyManager.register(config);
      const result = await hotkeyManager.register(config);

      expect(result).toBe(false);
    });

    it('should use fallback when primary hotkey fails', async () => {
      // Simulate conflict
      const mockRegister = jest.fn()
        .mockResolvedValueOnce(false) // Primary fails
        .mockResolvedValueOnce(true);  // Fallback succeeds

      hotkeyManager['platformSpecificRegister'] = mockRegister;

      const result = await hotkeyManager.register({
        key: 'CommandOrControl+Space',
        platform: process.platform,
        handler: () => {}
      });

      expect(result).toBe(true);
      expect(mockRegister).toHaveBeenCalledTimes(2);
    });
  });

  describe('platform-specific registration', () => {
    it('should register on macOS', async () => {
      if (process.platform !== 'darwin') return;

      const result = await hotkeyManager.register({
        key: 'Command+Shift+Space',
        platform: 'darwin',
        handler: () => {}
      });

      expect(result).toBe(true);
    });

    it('should register on Windows', async () => {
      if (process.platform !== 'win32') return;

      const result = await hotkeyManager.register({
        key: 'Control+Shift+Space',
        platform: 'win32',
        handler: () => {}
      });

      expect(result).toBe(true);
    });
  });
});
```

#### 8.2 Integration Tests

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ D-Bus –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç GNOME –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```typescript
// electron/main/hotkeys/gnome-wayland-dbus.test.ts
describe('GnomeWaylandHotkeyHandler', () => {
  let handler: GnomeWaylandHotkeyHandler;

  beforeEach(() => {
    handler = new GnomeWaylandHotkeyHandler();
  });

  it('should convert Electron accelerator to GNOME format', () => {
    const result = handler['convertToGnomeFormat']('Super+Shift+Space');
    expect(result).toBe('<Super><Shift>space');
  });

  // –≠—Ç–∏ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ GNOME Wayland
  it.skip('should register hotkey via D-Bus', async () => {
    const callback = jest.fn();
    const success = await handler.register('Super+Shift+Space', callback);

    expect(success).toBe(true);
  });
});
```

### 9. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### 9.1 User Documentation

–°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–¥–µ–ª –≤ README.md:

```markdown
## Global Hotkey Configuration

The overlay can be toggled using a global hotkey. Default hotkeys:

- **macOS**: `Globe + Space` (or `‚åò + ‚áß + Space` as fallback)
- **Windows**: `Win + ‚áß + Space`
- **Linux**: `Super + ‚áß + Space`

### Changing the Hotkey

1. Click the settings icon in the overlay
2. Click "Change Hotkey"
3. Press your desired key combination
4. The hotkey will be registered automatically

### Troubleshooting

**Hotkey not working:**
- On macOS: Grant Accessibility permissions in System Preferences
- On Windows: Check if another app is using the same hotkey
- On Linux (Wayland): Ensure GNOME Shell extensions are enabled

**Globe key not detected (macOS):**
- Try using the fallback: `‚åò + ‚áß + Space`
- Check System Preferences ‚Üí Keyboard ‚Üí Globe key setting
```

#### 9.2 Developer Documentation

```markdown
## Hotkey System Architecture

### Platform Support

| Platform | Method | Globe Key | Notes |
|----------|--------|-----------|-------|
| macOS (X11) | electron.globalShortcut | ‚ùå | Fallback to Command+Shift |
| macOS (native) | IOKit/Carbon | ‚ö†Ô∏è | Requires native addon |
| Windows | electron.globalShortcut | N/A | Full support |
| Linux (X11) | electron.globalShortcut | N/A | Full support |
| Linux (Wayland) | D-Bus (GNOME Shell) | N/A | GNOME only |

### Adding Custom Hotkeys

```typescript
import { HotkeyManager } from './electron/main/hotkey-manager';

const hotkeyManager = new HotkeyManager(windowManager);

await hotkeyManager.register({
  key: 'CommandOrControl+Shift+K',
  platform: process.platform,
  handler: () => {
    console.log('Custom hotkey triggered!');
  }
});
```
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Hotkey Manager                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   Main Process   ‚îÇ         ‚îÇ  Renderer Process‚îÇ          ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ         ‚îÇ                  ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ HotkeyManager  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ ‚Ä¢ Settings UI    ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Platform       ‚îÇ   IPC   ‚îÇ ‚Ä¢ Hotkey Recorder‚îÇ          ‚îÇ
‚îÇ  ‚îÇ   Detection      ‚îÇ         ‚îÇ ‚Ä¢ Conflict Dialog‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ           ‚îÇ                                                  ‚îÇ
‚îÇ           ‚ñº                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ  ‚îÇ         Platform-Specific Handlers               ‚îÇ        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  macOS:                                          ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ globalShortcut   ‚îÇ  ‚îÇ IOKit/Carbon      ‚îÇ   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (fallback)       ‚îÇ  ‚îÇ (Globe key)       ‚îÇ   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  Windows:                                        ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                           ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ globalShortcut   ‚îÇ                           ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                           ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  Linux:                                          ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ globalShortcut   ‚îÇ  ‚îÇ D-Bus (GNOME)     ‚îÇ   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (X11)            ‚îÇ  ‚îÇ (Wayland)         ‚îÇ   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Registration Flow:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   User      ‚îÇ
‚îÇ   Action    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Detect Platform   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ Select Handler      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚ñº                   ‚ñº                   ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ macOS Handler  ‚îÇ  ‚îÇWindows Handler ‚îÇ  ‚îÇ Linux Handler  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ                   ‚îÇ                   ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚ñº
                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ Success / Fallback ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –†–∏—Å–∫–∏ –∏ –ú–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: Globe key –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ macOS

**–ü—Ä–æ–±–ª–µ–º–∞:** Electron –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Globe key

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –Ω–∞ `Command+Shift+Space`
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–æ–∑–¥–∞—Ç—å native addon –¥–ª—è IOKit integration

### –†–∏—Å–∫ 2: GNOME Wayland D-Bus —Å–ª–æ–∂–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:** D-Bus API –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è D-Bus –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
- Fallback –Ω–∞ manual overlay toggle —á–µ—Ä–µ–∑ tray icon
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö GNOME

### –†–∏—Å–∫ 3: Hotkey conflicts

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å hotkey, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –∑–∞–Ω—è—Ç

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- Automatic fallback –Ω–∞ alternative hotkey
- UI –¥–ª—è notification –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ

### –†–∏—Å–∫ 4: macOS Accessibility permissions

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ macOS —Ç—Ä–µ–±—É—é—Ç—Å—è Accessibility permissions –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö hotkeys

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ permissions –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ü–æ–∫–∞–∑ dialog —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –µ—Å–ª–∏ permissions –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã
- Fallback –Ω–∞ –º–µ–Ω–µ–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ hotkeys

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

- [ ] Hotkey —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —Ç—Ä–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö (macOS, Windows, Linux)
- [ ] Fallback hotkey –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ
- [ ] UI –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ hotkey –≤ overlay settings
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è hotkey —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- [ ] GNOME Wayland D-Bus –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] macOS Accessibility permissions –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- [ ] Unit tests –¥–ª—è HotkeyManager (–ø–æ–∫—Ä—ã—Ç–∏–µ >80%)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [ ] Error handling –¥–ª—è –≤—Å–µ—Ö edge cases

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (Story 1.4)

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Story 1.3:
1. MCP Server Integration - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MCP voice server
2. Voice Status Indicators - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è listening/speaking states
3. System Tray Integration - minimize to tray functionality

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

```bash
# Development —Å hot reload
npm run electron:dev

# Build production
npm run electron:build

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ hotkey manager
npm test -- --testPathPattern=hotkey-manager

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
npm test -- --testPathPattern=hotkey-manager --testNamePattern="macOS"
```

## –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `electron/main/hotkey-manager.ts` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å HotkeyManager
- `electron/main/hotkey-manager.test.ts` - unit tests
- `electron/main/hotkeys/macos-globe-key.ts` - macOS Globe key handler
- `electron/main/hotkeys/windows-hotkey.ts` - Windows handler
- `electron/main/hotkeys/gnome-wayland-dbus.ts` - GNOME Wayland D-Bus handler
- `electron/main/permissions/macos-accessibility.ts` - macOS permissions
- `electron/renderer/settings.ts` - Settings UI logic
- `electron/renderer/hotkey-recorder.ts` - Hotkey recording component

### –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:
- `electron/main/index.ts` - –¥–æ–±–∞–≤–∏—Ç—å HotkeyManager initialization
- `electron/preload/types.ts` - —Ä–∞—Å—à–∏—Ä–∏—Ç—å ElectronAPI
- `electron/preload/index.ts` - expose hotkey methods
- `electron/renderer/index.html` - –¥–æ–±–∞–≤–∏—Ç—å settings panel
- `electron/renderer/styles.css` - —Å—Ç–∏–ª–∏ –¥–ª—è settings
- `package.json` - –¥–æ–±–∞–≤–∏—Ç—å `dbus-next` dependency

## –°—Å—ã–ª–∫–∏

- [Electron globalShortcut API](https://www.electronjs.org/docs/latest/api/global-shortcut)
- [GNOME Shell D-Bus API](https://wiki.gnome.org/Projects/GnomeShell/DBus)
- [macOS IOKit Framework](https://developer.apple.com/documentation/iokit)
- [dbus-next npm package](https://www.npmjs.com/package/dbus-next)
- [Electron systemPreferences](https://www.electronjs.org/docs/latest/api/system-preferences)
